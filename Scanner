local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

if LocalPlayer.Name ~= "CapLonerPo" then
	return
end

local gui = Instance.new("ScreenGui")
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local OpenButton = Instance.new("Frame")
OpenButton.Size = UDim2.new(0, 65, 0, 65)
OpenButton.Position = UDim2.new(0, 20, 1, -85)
OpenButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
OpenButton.BorderSizePixel = 0
OpenButton.Parent = gui

local openCorner = Instance.new("UICorner")
openCorner.CornerRadius = UDim.new(0, 18)
openCorner.Parent = OpenButton

local OpenBtnText = Instance.new("TextButton")
OpenBtnText.Size = UDim2.new(1, 0, 1, 0)
OpenBtnText.BackgroundTransparency = 1
OpenBtnText.Text = "Scan"
OpenBtnText.TextColor3 = Color3.fromRGB(230, 230, 230)
OpenBtnText.Font = Enum.Font.GothamBold
OpenBtnText.TextSize = 20
OpenBtnText.Parent = OpenButton

local Main = Instance.new("Frame")
Main.Size = UDim2.new(0, 390, 0, 440)
Main.Position = UDim2.new(0.5, -195, 0.5, -220)
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Main.BorderSizePixel = 0
Main.Visible = false
Main.Parent = gui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 15)
mainCorner.Parent = Main

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -50, 0, 50)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Scanner"
Title.TextColor3 = Color3.fromRGB(240, 240, 240)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 28
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Main

local Close = Instance.new("TextButton")
Close.Size = UDim2.new(0, 40, 0, 40)
Close.Position = UDim2.new(1, -45, 0, 5)
Close.BackgroundTransparency = 1
Close.Text = "X"
Close.TextColor3 = Color3.fromRGB(200, 60, 60)
Close.Font = Enum.Font.GothamBold
Close.TextSize = 24
Close.Parent = Main

local SearchBox = Instance.new("TextBox")
SearchBox.Size = UDim2.new(1, -30, 0, 48)
SearchBox.Position = UDim2.new(0, 15, 0, 60)
SearchBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
SearchBox.BorderSizePixel = 0
SearchBox.TextColor3 = Color3.fromRGB(230, 230, 230)
SearchBox.Font = Enum.Font.GothamBold
SearchBox.TextSize = 20
SearchBox.PlaceholderText = "Searchâ€¦"
SearchBox.Parent = Main

local sCorner = Instance.new("UICorner")
sCorner.CornerRadius = UDim.new(0, 12)
sCorner.Parent = SearchBox

local Results = Instance.new("ScrollingFrame")
Results.Size = UDim2.new(1, -30, 1, -130)
Results.Position = UDim2.new(0, 15, 0, 120)
Results.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Results.BorderSizePixel = 0
Results.CanvasSize = UDim2.new(0, 0, 0, 0)
Results.AutomaticCanvasSize = Enum.AutomaticSize.Y
Results.ScrollBarThickness = 6
Results.Parent = Main

local rCorner = Instance.new("UICorner")
rCorner.CornerRadius = UDim.new(0, 12)
rCorner.Parent = Results

local layout = Instance.new("UIListLayout")
layout.Parent = Results
layout.Padding = UDim.new(0, 6)

local function scan(keyword)
	keyword = keyword:lower()
	local function deep(obj)
		for _, c in ipairs(obj:GetChildren()) do
			if c.Name:lower():find(keyword) then
				local item = Instance.new("TextLabel")
				item.Size = UDim2.new(1, -10, 0, 32)
				item.BackgroundTransparency = 1
				item.Font = Enum.Font.GothamBold
				item.TextSize = 17
				item.TextColor3 = Color3.fromRGB(230, 230, 230)
				item.Text = c:GetFullName()
				item.Parent = Results
			end
			deep(c)
		end
	end
	deep(game)
end

SearchBox.FocusLost:Connect(function(enter)
	if enter then
		for _, v in pairs(Results:GetChildren()) do
			if v:IsA("TextLabel") then
				v:Destroy()
			end
		end
		local l = Instance.new("UIListLayout")
		l.Padding = UDim.new(0, 6)
		l.Parent = Results
		scan(SearchBox.Text)
	end
end)

local function openUI()
	Main.Visible = true
	Main.Position = UDim2.new(0.5, -195, 1, 100)
	TweenService:Create(Main, TweenInfo.new(0.28, Enum.EasingStyle.Quad), {Position = UDim2.new(0.5, -195, 0.5, -220)}):Play()
end

local function closeUI()
	local tween = TweenService:Create(Main, TweenInfo.new(0.28, Enum.EasingStyle.Quad), {Position = UDim2.new(0.5, -195, 1, 100)})
	tween:Play()
	tween.Completed:Connect(function()
		Main.Visible = false
	end)
end

OpenBtnText.MouseButton1Click:Connect(openUI)
Close.MouseButton1Click:Connect(closeUI)

local function dragify(frame)
	local dragging = false
	local dragStart
	local startPos
	
	frame.InputBegan:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = i.Position
			startPos = frame.Position
		end
	end)

	frame.InputChanged:Connect(function(i)
		if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then
			local delta = i.Position - dragStart
			frame.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
	end)

	UIS.InputEnded:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
			dragging = false
		end
	end)
end

dragify(Main)
dragify(OpenButton)
